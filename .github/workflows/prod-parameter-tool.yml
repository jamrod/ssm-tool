name: prod ssm-parameter-tool stack lint and deploy
on:
  push:
    branches-ignore:
      - main
    paths:
      - "layers/**/*"
      - "infrastructure/ssm_parameter_tool_stack"
      - "lambdas/ssm_parameter_tool/*"
      - "app.py"
      - "parameter_store.json"

jobs:
  Lint:
    uses: ./.github/workflows/lint.yml

  Deploy-shared-layer:
    needs: Lint
    uses: ./.github/workflows/deploy-shared-layer.yml
    with:
      stage: PRD
      role_arn: arn:aws:iam::747207162522:role/PCMCloudAdmin
      stack: SsmSharedLayerStack

  Deploy-ssm-parameter-tool:
    needs: Deploy-shared-layer
    uses: ./.github/workflows/deploy.yml
    with:
      stage: PRD
      role_arn: arn:aws:iam::747207162522:role/PCMCloudAdmin
      stack: SsmParameterToolStack
